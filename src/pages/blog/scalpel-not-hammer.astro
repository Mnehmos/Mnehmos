---
import BaseLayout from "../../layouts/BaseLayout.astro";

const title = "The Scalpel, Not the Hammer: Surgical Patterns for MCP Servers";
const description =
  "Five patterns from production MCP servers that cut token usage and eliminate retry loops. Real code, real impact.";
const pubDate = new Date("2025-12-31");
const tags = ["mcp", "tokens", "patterns", "architecture"];
const base = import.meta.env.BASE_URL;
---

<BaseLayout title={title} description={description}>
  <article class="max-w-4xl mx-auto px-6 py-12 md:py-20 overflow-hidden">
    <!-- Breadcrumbs -->
    <nav class="mb-12 animate-fade-in">
      <a
        href={`${base}blog`}
        class="text-stone-500 dark:text-stone-400 hover:text-copper transition-colors flex items-center gap-2 text-sm font-medium group"
      >
        <svg
          class="w-4 h-4 transform group-hover:-translate-x-1 transition-transform"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"></path>
        </svg>
        Back to Blog
      </a>
    </nav>

    <!-- Header -->
    <header class="mb-16">
      <div class="flex flex-wrap gap-2 mb-6 animate-fade-in">
        {
          tags.map((tag) => (
            <span class="px-3 py-1 bg-copper/10 text-copper text-xs font-bold uppercase tracking-wider rounded-full border border-copper/10">
              {tag}
            </span>
          ))
        }
      </div>

      <h1
        class="font-display text-4xl md:text-6xl font-bold text-stone-900 dark:text-stone-100 mb-6 leading-tight animate-slide-up"
      >
        The Scalpel, Not the Hammer
      </h1>

      <p
        class="text-xl md:text-2xl text-stone-600 dark:text-stone-300 mb-8 border-l-4 border-copper pl-6 italic animate-slide-up animation-delay-100"
      >
        {description}
      </p>

      <div
        class="flex items-center gap-4 text-stone-500 font-medium animate-fade-in animation-delay-200"
      >
        <div
          class="w-10 h-10 rounded-full bg-stone-200 dark:bg-stone-700 flex items-center justify-center text-stone-600 dark:text-stone-300 font-bold border-2 border-white dark:border-stone-800 shadow-sm"
        >
          V
        </div>
        <div>
          <div class="text-stone-900 dark:text-stone-200 leading-none mb-1">
            Vario <span class="text-stone-500 dark:text-stone-400 font-normal">aka</span> <span class="text-copper font-normal">Mnehmos</span>
          </div>
          <time datetime={pubDate.toISOString()} class="text-sm">
            {
              pubDate.toLocaleDateString("en-US", {
                year: "numeric",
                month: "long",
                day: "numeric",
              })
            }
          </time>
        </div>
      </div>
    </header>

    <!-- The Token Equation -->
    <section
      class="prose prose-stone dark:prose-invert prose-lg max-w-none mb-20 scroll-reveal"
    >
      <h2 class="font-display text-copper text-3xl font-bold mb-6">
        The Token Equation
      </h2>

      <div class="my-12 not-prose">
        <div class="bg-white dark:bg-stone-800 border-2 border-stone-900 dark:border-stone-700 rounded-xl p-8 shadow-lg transition-colors">
          <div class="text-center mb-8">
            <div class="font-mono text-2xl text-copper mb-2">
              Tokens = Scope √ó Iterations √ó Verbosity
            </div>
            <div class="text-stone-500 text-sm">Most approaches only attack verbosity. We cut all three.</div>
          </div>
          
          <div class="grid md:grid-cols-3 gap-6">
            <div class="text-center p-4 bg-stone-50 dark:bg-stone-900 rounded-xl">
              <div class="text-3xl mb-2">üìê</div>
              <div class="font-bold text-stone-900 dark:text-stone-100 mb-1">Scope</div>
              <div class="text-sm text-stone-500">Files read, options considered, tangents explored</div>
            </div>
            <div class="text-center p-4 bg-stone-50 dark:bg-stone-900 rounded-xl">
              <div class="text-3xl mb-2">üîÑ</div>
              <div class="font-bold text-stone-900 dark:text-stone-100 mb-1">Iterations</div>
              <div class="text-sm text-stone-500">Retries from validation failures, ambiguous inputs</div>
            </div>
            <div class="text-center p-4 bg-stone-50 dark:bg-stone-900 rounded-xl">
              <div class="text-3xl mb-2">üí¨</div>
              <div class="font-bold text-stone-900 dark:text-stone-100 mb-1">Verbosity</div>
              <div class="text-sm text-stone-500">Message size per round trip</div>
            </div>
          </div>
        </div>
      </div>

      <p>
        Five patterns from production MCP servers that cut across all three factors.
      </p>
    </section>

    <!-- Pattern 1: Fuzzy Enum -->
    <section class="mb-20 scroll-reveal">
      <div
        class="bg-white dark:bg-stone-900 border border-stone-200 dark:border-stone-800 p-8 md:p-12 rounded-4xl shadow-sm relative overflow-hidden transition-colors"
      >
        <div
          class="absolute -right-20 -top-20 w-64 h-64 bg-copper/5 rounded-full blur-3xl"
        >
        </div>
        <h2 class="font-display text-copper text-4xl font-bold mb-4">
          1. Fuzzy Enum Matching
        </h2>
        <p
          class="text-lg text-stone-600 dark:text-stone-300 mb-8 leading-relaxed"
        >
          LLMs make typos. "indor" instead of "indoor". Rigid schemas reject, LLM retries, tokens wasted.
          <br /><br />
          <strong>Solution:</strong> Three-tier matching that auto-corrects. From <code class="text-copper">chatrpg.game/src/fuzzy-enum.ts</code>:
        </p>

        <div class="bg-stone-950 rounded-xl p-6 font-mono text-sm text-stone-300 overflow-x-auto mb-8 border-l-4 border-copper">
          <pre>{`export function findBestMatch(
  input: string,
  validValues: readonly string[],
  aliasCategory?: string
): { match: string | null; confidence: 'exact' | 'alias' | 'fuzzy' | 'none' } {
  const normalizedInput = input.toLowerCase().trim();

  // 1. Exact match (case-insensitive)
  const exactMatch = validValues.find(v => v.toLowerCase() === normalizedInput);
  if (exactMatch) return { match: exactMatch, confidence: 'exact' };

  // 2. Alias mappings (interior ‚Üí indoor, blind ‚Üí blinded)
  if (aliasCategory && GLOBAL_ALIASES[aliasCategory]) {
    const aliasedValue = GLOBAL_ALIASES[aliasCategory][normalizedInput];
    if (aliasedValue) return { match: aliasedValue, confidence: 'alias' };
  }

  // 3. Levenshtein fallback (max distance: 2 for short, 3 for longer)
  let bestMatch = null, bestDistance = Infinity;
  for (const validValue of validValues) {
    const distance = levenshteinDistance(normalizedInput, validValue.toLowerCase());
    if (distance < bestDistance) {
      bestDistance = distance;
      bestMatch = validValue;
    }
  }

  const maxDistance = normalizedInput.length <= 5 ? 2 : 3;
  if (bestDistance <= maxDistance && bestMatch) {
    return { match: bestMatch, confidence: 'fuzzy', distance: bestDistance };
  }

  return { match: null, confidence: 'none' };
}`}</pre>
        </div>

        <div class="grid md:grid-cols-3 gap-4">
          <div class="bg-stone-50 dark:bg-stone-950 p-4 rounded-xl border border-stone-200 dark:border-stone-800">
            <div class="text-copper font-bold mb-2 text-sm">Exact</div>
            <div class="text-sm text-stone-500 dark:text-stone-400">
              <code>"indoor"</code> ‚Üí <code>"indoor"</code>
            </div>
          </div>
          <div class="bg-stone-50 dark:bg-stone-950 p-4 rounded-xl border border-stone-200 dark:border-stone-800">
            <div class="text-copper font-bold mb-2 text-sm">Alias</div>
            <div class="text-sm text-stone-500 dark:text-stone-400">
              <code>"twilight"</code> ‚Üí <code>"dim"</code>
            </div>
          </div>
          <div class="bg-stone-50 dark:bg-stone-950 p-4 rounded-xl border border-stone-200 dark:border-stone-800">
            <div class="text-copper font-bold mb-2 text-sm">Fuzzy</div>
            <div class="text-sm text-stone-500 dark:text-stone-400">
              <code>"indor"</code> ‚Üí <code>"indoor"</code>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- The Alias Registry -->
    <section
      class="prose prose-stone dark:prose-invert prose-lg max-w-none mb-20 scroll-reveal"
    >
      <h2 class="font-display text-copper text-3xl font-bold mb-6">
        The Alias Registry
      </h2>
      <p>
        We map 285+ synonyms to canonical values across 15+ categories. The LLM says what's natural:
      </p>

      <div class="my-8 not-prose">
        <div class="bg-stone-950 rounded-xl p-6 font-mono text-xs text-stone-300 overflow-x-auto border-l-4 border-copper">
          <pre>{`const GLOBAL_ALIASES: Record<string, Record<string, string>> = {
  lighting: {
    'light': 'bright', 'lit': 'bright', 'well-lit': 'bright',
    'shadowy': 'dim', 'low': 'dim', 'twilight': 'dim',
    'dark': 'darkness', 'pitch-black': 'darkness',
  },
  condition: {
    'blind': 'blinded', 'charm': 'charmed', 'deaf': 'deafened',
    'exhaust': 'exhaustion', 'fear': 'frightened', 'scared': 'frightened',
    'grapple': 'grappled', 'paralyze': 'paralyzed', 'stun': 'stunned',
  },
  damageType: {
    'slash': 'slashing', 'pierce': 'piercing', 'blunt': 'bludgeoning',
    'flame': 'fire', 'heat': 'fire', 'ice': 'cold', 'frost': 'cold',
    'electric': 'lightning', 'death': 'necrotic', 'holy': 'radiant',
  },
  ability: {
    'strength': 'str', 'dexterity': 'dex', 'constitution': 'con',
    'intelligence': 'int', 'wisdom': 'wis', 'charisma': 'cha',
  },
  skill: {
    'animal': 'animal_handling', 'intimidate': 'intimidation',
    'investigate': 'investigation', 'sneak': 'stealth',
  },
  actionType: {
    'strike': 'attack', 'hit': 'attack', 'run': 'dash', 'grab': 'grapple',
  },
  // ... 15+ more categories
};`}</pre>
        </div>
      </div>

      <p>
        <code>"scared"</code> works. <code>"frightened"</code> works. <code>"fear"</code> works.
        <strong>Zero prompt engineering required.</strong>
      </p>
    </section>

    <!-- Pattern 2: Guiding Errors -->
    <section class="mb-20 scroll-reveal">
      <div
        class="relative bg-stone-900 rounded-4xl p-8 md:p-12 overflow-hidden text-stone-300"
      >
        <div
          class="absolute inset-0 bg-linear-to-b from-stone-800/50 to-stone-900 pointer-events-none"
        >
        </div>
        <div class="absolute top-0 right-0 p-8 opacity-10">
          <svg class="w-64 h-64" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"></path>
          </svg>
        </div>

        <div class="relative z-10">
          <h2
            class="font-display text-3xl md:text-4xl font-bold text-white mb-6"
          >
            2. Guiding Errors
          </h2>
          <p class="text-lg leading-relaxed mb-8">
            When fuzzy matching fails, <strong class="text-copper">the error teaches the fix</strong>. 
            From <code>ooda.mcp/src/tools/diff/editBlock.ts</code>:
          </p>

          <div class="bg-stone-950 p-6 rounded-xl font-mono text-xs text-stone-400 overflow-x-auto mb-6">
            <pre>{`// When exact match fails, show what we found
if (similarity >= fuzzyThreshold) {
  return {
    success: false,
    message: 
      \`Found similar text with \${Math.round(similarity * 100)}% similarity.\\n\\n\` +
      \`To apply this edit, use the exact text from the file:\\n\` +
      \`\\\`\\\`\\\`\\n\${fuzzyMatch.value}\\n\\\`\\\`\\\`\\n\\n\` +
      \`Preview of changes:\\n\${diffResult.unified}\`,
    fuzzyMatch: { similarity, foundText: fuzzyMatch.value, inlineDiff }
  };
}

// When no match is close enough
return {
  success: false,
  message: 
    \`Search text not found.\\n\\n\` +
    \`Closest match was \${Math.round(similarity * 100)}% similar.\\n\\n\` +
    \`Character differences:\\n\${inlineDiff}\\n\\n\` +
    \`Suggestions:\\n\` +
    \`1. Use read_file_lines to see exact content\\n\` +
    \`2. Copy the exact text from file\\n\` +
    \`3. Check for whitespace differences\`,
};`}</pre>
          </div>

          <div class="grid md:grid-cols-2 gap-4">
            <div class="bg-stone-950 p-4 rounded-xl border border-stone-800">
              <div class="text-red-400 font-mono font-bold mb-2 text-sm">‚ùå Unhelpful</div>
              <p class="text-sm text-stone-400">
                <code>"Search text not found"</code><br />
                LLM guesses. Wrong. Guesses again. Wrong again.
              </p>
            </div>
            <div class="bg-stone-950 p-4 rounded-xl border border-stone-800">
              <div class="text-green-400 font-mono font-bold mb-2 text-sm">‚úì Guiding</div>
              <p class="text-sm text-stone-400">
                <code>"87% similar. Use this exact text: ..."</code><br />
                LLM copies exact text. Success on retry 1.
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Pattern 3: Batch Operations -->
    <section
      class="bg-stone-100 dark:bg-stone-900 rounded-4xl p-8 md:p-12 mb-20 scroll-reveal transition-colors"
    >
      <h2
        class="font-display text-3xl font-bold text-stone-900 dark:text-stone-100 mb-8"
      >
        3. Batch Operations
      </h2>
      <p class="text-lg text-stone-600 dark:text-stone-400 mb-8">
        Every file operation in <code>ooda.mcp</code> has a batch variant. 20 calls ‚Üí 1 call.
      </p>

      <div class="bg-white dark:bg-stone-950 p-6 rounded-2xl shadow-sm border border-stone-200 dark:border-stone-800 mb-8">
        <div class="grid md:grid-cols-2 gap-4 text-sm font-mono">
          <div class="space-y-1 text-stone-600 dark:text-stone-400">
            <div><span class="text-copper">batch_read_files</span> - Read N files in parallel</div>
            <div><span class="text-copper">batch_write_files</span> - Write N files in parallel</div>
            <div><span class="text-copper">batch_str_replace</span> - Replace across N files</div>
            <div><span class="text-copper">batch_exec_cli</span> - Run N commands in parallel</div>
          </div>
          <div class="space-y-1 text-stone-600 dark:text-stone-400">
            <div><span class="text-copper">batch_file_info</span> - Get metadata for N paths</div>
            <div><span class="text-copper">batch_copy_files</span> - Copy N files in parallel</div>
            <div><span class="text-copper">batch_search_in_files</span> - Search with fuzzy</div>
            <div><span class="text-copper">batch_keyboard_actions</span> - Input sequences</div>
          </div>
        </div>
      </div>

      <div class="bg-stone-950 rounded-xl p-6 font-mono text-sm text-stone-300 overflow-x-auto">
        <pre>{`// Batch search with fuzzy matching
batch_search_in_files({
  searches: [
    { path: "src/auth.ts", pattern: "validateToken" },
    { path: "src/types.ts", pattern: "TokenPayload" },
    { path: "tests/auth.test.ts", pattern: "describe.*token" }
  ],
  isFuzzy: true,           // Enable Levenshtein matching
  fuzzyThreshold: 0.7,     // 70% similarity threshold
  contextLines: 2,         // Include surrounding context
  maxMatchesPerFile: 50
});

// All matches in ONE response. Token savings: ~90%`}</pre>
      </div>
    </section>

    <!-- Pattern 4: Flexible Identifiers -->
    <section
      class="prose prose-stone dark:prose-invert prose-lg max-w-none mb-20 scroll-reveal"
    >
      <h2 class="font-display text-copper text-3xl font-bold mb-6">
        4. Flexible Identifiers
      </h2>
      <p>
        LLMs remember names better than UUIDs. Every character tool in <code>chatrpg.game</code>
        accepts <strong>either</strong> identifier:
      </p>

      <div class="my-8 not-prose">
        <div class="grid md:grid-cols-2 gap-4">
          <div class="bg-stone-950 rounded-xl p-4 font-mono text-xs text-stone-300 overflow-x-auto">
            <div class="text-copper mb-2">// By UUID (precise)</div>
            <pre>{`take_rest({
  characterId: "a7f3b2c1-...",
  restType: "long"
})`}</pre>
          </div>
          <div class="bg-stone-950 rounded-xl p-4 font-mono text-xs text-stone-300 overflow-x-auto">
            <div class="text-copper mb-2">// By name (natural)</div>
            <pre>{`take_rest({
  characterName: "Fenric the Bold",
  restType: "long"
})`}</pre>
          </div>
        </div>
      </div>

      <p>
        Server resolves names to IDs internally. The LLM uses what it remembers.
        <strong>Fewer lookups = fewer tokens.</strong>
      </p>
    </section>

    <!-- Pattern 5: Workspace Scope -->
    <section class="mb-20 scroll-reveal">
      <div
        class="bg-white dark:bg-stone-900 border border-stone-200 dark:border-stone-800 p-8 md:p-12 rounded-4xl shadow-sm relative overflow-hidden transition-colors"
      >
        <h2 class="font-display text-copper text-4xl font-bold mb-4">
          5. Workspace Boundaries
        </h2>
        <p
          class="text-lg text-stone-600 dark:text-stone-300 mb-8 leading-relaxed"
        >
          In multi-agent workflows, scope creep kills token budgets. Agents read files they don't need,
          consider options outside their domain.
          <br /><br />
          Task delegation includes explicit boundaries:
        </p>

        <div class="bg-stone-950 rounded-xl p-6 font-mono text-sm text-stone-300 overflow-x-auto border-l-4 border-copper">
          <pre>{`{
  task_id: "implement_auth_validation",
  assigned_to: "green-phase",
  
  // THE SCALPEL: Explicit boundaries
  workspace_path: "src/auth/",
  file_patterns: ["*.ts", "!*.test.ts"],
  
  in_scope: [
    "src/auth/validateToken.ts",
    "src/auth/types.ts"
  ],
  
  out_of_scope: [
    "src/auth/*.test.ts",  // Red phase owns tests
    "src/database/*",       // Different domain
    "src/api/*"             // Different domain
  ],
  
  acceptance_criteria: [
    "All tests in tests/auth/ pass",
    "No modifications outside workspace_path"
  ]
}`}</pre>
        </div>

        <p class="mt-6 text-stone-500 dark:text-stone-400">
          Agents that know their boundaries don't explore. They do their job and stop.
        </p>
      </div>
    </section>

    <!-- Impact -->
    <section
      class="prose prose-stone dark:prose-invert prose-lg max-w-none mb-20 scroll-reveal"
    >
      <h2 class="font-display text-copper text-3xl font-bold mb-6">
        Production Impact
      </h2>

      <div class="my-12 not-prose">
        <div class="bg-white dark:bg-stone-800 border-2 border-stone-900 dark:border-stone-700 rounded-xl p-8 shadow-lg transition-colors">
          <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="text-center p-4 bg-stone-50 dark:bg-stone-900 rounded-xl">
              <div class="text-3xl font-bold text-copper mb-1">~95%</div>
              <div class="text-sm text-stone-500">Retry reduction from fuzzy matching</div>
            </div>
            <div class="text-center p-4 bg-stone-50 dark:bg-stone-900 rounded-xl">
              <div class="text-3xl font-bold text-copper mb-1">20‚Üí1</div>
              <div class="text-sm text-stone-500">Call reduction from batch ops</div>
            </div>
            <div class="text-center p-4 bg-stone-50 dark:bg-stone-900 rounded-xl">
              <div class="text-3xl font-bold text-copper mb-1">285+</div>
              <div class="text-sm text-stone-500">Aliases across 15+ categories</div>
            </div>
            <div class="text-center p-4 bg-stone-50 dark:bg-stone-900 rounded-xl">
              <div class="text-3xl font-bold text-copper mb-1">0</div>
              <div class="text-sm text-stone-500">Custom syntax to teach</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Summary -->
    <section class="mb-20 scroll-reveal">
      <div class="bg-stone-950 rounded-xl p-8 border-l-4 border-copper">
        <h2 class="font-display text-white text-3xl font-bold mb-6">
          The Five Patterns
        </h2>
        <div class="text-stone-300 space-y-4 text-lg leading-relaxed">
          <p>
            <strong class="text-copper">1. Fuzzy Enum.</strong>
            Auto-correct typos with Levenshtein. Map synonyms with aliases.
          </p>
          <p>
            <strong class="text-copper">2. Guiding Errors.</strong>
            "87% similar. Use this exact text: ..." beats "Not found" every time.
          </p>
          <p>
            <strong class="text-copper">3. Batch Operations.</strong>
            If you might do it 5 times, expose a <code>batch_*</code> variant.
          </p>
          <p>
            <strong class="text-copper">4. Flexible Identifiers.</strong>
            Accept name OR ID. Let the LLM use what it remembers.
          </p>
          <p>
            <strong class="text-copper">5. Workspace Boundaries.</strong>
            Explicit <code>in_scope</code> / <code>out_of_scope</code>. Agents don't explore.
          </p>
        </div>
      </div>
    </section>

    <!-- Footer Meta -->
    <footer
      class="text-center pt-16 border-t border-stone-200 dark:border-stone-800"
    >
      <p class="text-stone-500 mb-8 max-w-md mx-auto">
        These patterns are live in <code>ooda.mcp</code>, <code>chatrpg.game</code>, and <code>multi-agent.framework</code>.
      </p>
      <div class="flex justify-center gap-6">
        <a
          href="https://github.com/Mnehmos"
          class="text-stone-400 hover:text-copper transition-colors"
        >
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"
            ><path
              d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.111.825-.261.825-.579 0-.285-.011-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.22 0 4.609-2.807 5.627-5.479 5.921.43.372.823 1.102.823 2.222 0 1.606-.015 2.896-.015 3.286 0 .321.222.696.832.57C20.565 21.795 24 17.31 24 12c0-6.63-5.37-12-12-12z"
            ></path></svg
          >
        </a>
      </div>
    </footer>
  </article>

  <!-- Global Animations -->
  <style is:global>
    @keyframes fade-in {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes slide-up {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in { animation: fade-in 1s ease-out forwards; }
    .animate-slide-up {
      opacity: 0;
      animation: slide-up 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }
    .animation-delay-100 { animation-delay: 0.1s; }
    .animation-delay-200 { animation-delay: 0.2s; }
    .scroll-reveal {
      opacity: 0;
      transform: translateY(40px);
      transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    }
    .scroll-reveal.active {
      opacity: 1;
      transform: translateY(0);
    }
  </style>

  <script>
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) entry.target.classList.add("active");
      });
    }, { threshold: 0.1, rootMargin: "0px 0px -50px 0px" });

    document.querySelectorAll(".scroll-reveal").forEach((el) => observer.observe(el));
  </script>
</BaseLayout>
